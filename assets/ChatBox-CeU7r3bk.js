import{h as oe,i as t,r as m,o as f,c as E,b as g,t as J,v as $,a as d,w as r,F as B,d as H,s as q,y as L,_ as le,l as ae,q as pe,k as Z,z as ve,m as ne,E as fe,A as ge,B as _e,n as he,C as be}from"./index-CklsWiTl.js";const ye={style:{"font-size":"large","font-weight":"bold"}},we={style:{"margin-top":"10px"}},xe=["src"],Ce={style:{"font-weight":"bold"}},ke=oe({__name:"PostBox",props:{post:{}},setup(G){function z(v){let p=[];return v&&v.routes&&v.routes.forEach(l=>{l&&l.events&&l.events.forEach(s=>{s&&s.images&&p.push(s.images[0])})}),p}const x=G,{post:_}=x;let o=0;const b=t("0"),T=t([{title:"Day 1",name:"1",content:"Tab 1 content"},{title:"Day 2",name:"2",content:"Tab 2 content"}]),M=(v,p)=>{if(p==="add"){const l=`${++o}`;T.value.push({title:"New Tab",name:l,content:"New Tab content"}),b.value=l}else if(p==="remove"){const l=T.value;let s=b.value;s===v&&l.forEach((w,i)=>{if(w.name===v){const C=l[i+1]||l[i-1];C&&(s=C.name)}}),b.value=s,T.value=l.filter(w=>w.name!==v)}};return(v,p)=>{const l=m("el-carousel-item"),s=m("el-carousel"),w=m("el-card"),i=m("el-timeline-item"),C=m("el-timeline"),k=m("el-tab-pane"),R=m("el-tabs");return f(),E(B,null,[g("h1",ye,J($(_).title),1),g("p",we,J($(_).text),1),d(s,{interval:4e3,type:"card",height:"200px",style:{"margin-top":"20px"}},{default:r(()=>[(f(!0),E(B,null,H(z($(_)),(a,N)=>(f(),q(l,{src:a,key:N,class:"topImg img"},{default:r(()=>[g("img",{src:a,alt:""},null,8,xe)]),_:2},1032,["src"]))),128))]),_:1}),d(R,{modelValue:b.value,"onUpdate:modelValue":p[0]||(p[0]=a=>b.value=a),type:"card",class:"demo-tabs",onEdit:M,style:{"margin-top":"20px","margin-right":"50px"}},{default:r(()=>[(f(!0),E(B,null,H($(_).routes,(a,N)=>(f(),q(k,{key:N,label:"Day"+(N+1),name:a.name},{default:r(()=>[L(J(a.name)+" ",1),d(C,{style:{"max-width":"600px","margin-top":"10px"}},{default:r(()=>[(f(!0),E(B,null,H(a.events,(V,y)=>{var O,D,I,e,n,c;return f(),q(i,{key:y,timestamp:(((D=(O=a==null?void 0:a.navigation)==null?void 0:O[y])==null?void 0:D.交通方式)||"")+"   "+(((e=(I=a==null?void 0:a.navigation)==null?void 0:I[y])==null?void 0:e.价格)||"")+"   "+(((c=(n=a==null?void 0:a.navigation)==null?void 0:n[y])==null?void 0:c.路程)||""),type:"primary",hollow:"true"},{default:r(()=>[d(w,null,{default:r(()=>[g("h3",Ce,J(V.name),1),g("p",null,J(V.description),1)]),_:2},1024)]),_:2},1032,["timestamp"])}),128))]),_:2},1024)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])],64)}}}),Ne=le(ke,[["__scopeId","data-v-6c63a857"]]),Se={class:"message-container"},Ee=["innerHTML"],Te={class:"dialog-footer"},Ve={class:"inputbox"},se="http://1.94.170.22:5000",Oe=oe({__name:"ChatBox",props:{currentChat:Object,userId:{type:Number}},setup(G){const z=t(!0),x=t(!1),_=t("");t([]);const o=t("");t("1");const b=t(!1),T=t("1"),M=t(0),v=t(0);let p=null;const l=t("60%");t("100%");const s=G,w=t(0),i=t([]),C=t();t();async function k(){await be();const e=Number.MAX_SAFE_INTEGER;C.value.setScrollTop(e)}ae(()=>{R(),p=window.addEventListener("resize",R)}),pe(()=>{p&&window.removeEventListener("resize",p)});const R=()=>{const e=document.documentElement.clientWidth;l.value=e<=768?"100%":"60%"};function a(){if(s.currentChat&&s.currentChat.history)try{JSON.parse(s.currentChat.history).messages?i.value=JSON.parse(s.currentChat.history).messages:i.value=[],o.value=s.currentChat.agentMemory,console.log("更新:"+o.value)}catch(e){console.error("Error parsing currentChat.history:",e),i.value=[],o.value="{}"}}ae(a),Z(()=>s.currentChat,(e,n)=>{a(),console.log("再更新:"+i.value),k()},{deep:!0}),Z(()=>i,(e,n)=>{k()});const N=async()=>{console.log(JSON.stringify(JSON.parse(o.value).routes[0]));try{(await ne.post(`${se}/save_generated_post`,{user_id:s.userId,title:JSON.parse(o.value).title,cover:JSON.parse(o.value).cover,images:"[]",text:JSON.parse(o.value).text,routes:JSON.stringify(JSON.parse(o.value).routes)})).data.status==="success"?console.log("Chat content saved successfully."):console.error("Failed to save chat content."),fe({title:"Success",type:"success",message:"已将帖子保存到个人空间，请在Home > Note中查看",duration:1500,offset:200})}catch(e){console.error("Error saving chat content:",e)}},V=async()=>{console.log("保存聊天内容:",'{"messages": "'+JSON.stringify(i.value)+'"}');try{(await ne.post(`${se}/save_chat_content`,{chat_id:s.currentChat.uid,history:JSON.stringify({messages:i.value}),agentMemory:o.value===""?"{}":o.value.replace(/\\n/g,"")})).data.status==="success"?console.log("Chat content saved successfully."):console.error("Failed to save chat content.")}catch(e){console.error("Error saving chat content:",e)}},y=t({title:"标题",cover:"封面base64编码",images:["图片A base64","图片B base64"],text:"滚滚长江东逝水滚滚长江东逝水滚滚长江东逝水滚滚长江东逝水，滚滚长江东逝水。滚滚长江东逝水滚滚长江东逝水。",routes:[{name:"路线1",navigation:[{起点:{name:"市中心广场",address:"市中心大道1号",location:{latitude:39.905489,longitude:116.401245}},终点:{name:"历史博物馆",address:"文化路88号",location:{latitude:39.906489,longitude:116.402245}},交通方式:"走路",路程:"2公里",价格:"免费"},{起点:{name:"历史博物馆",address:"文化路88号",location:{latitude:39.906489,longitude:116.402245}},终点:{name:"科技馆",address:"科技路100号",location:{latitude:39.907489,longitude:116.403245}},交通方式:"公交车",路程:"3.5公里",价格:"2元"},{起点:{name:"科技馆",address:"科技路100号",location:{latitude:39.907489,longitude:116.403245}},终点:{name:"购物中心",address:"商业大街200号",location:{latitude:39.908489,longitude:116.404245}},交通方式:"打车",路程:"5公里",价格:"20元"},{起点:{name:"购物中心",address:"商业大街200号",location:{latitude:39.908489,longitude:116.404245}},终点:{name:"公园",address:"自然路50号",location:{latitude:39.909489,longitude:116.405245}},交通方式:"骑车",路程:"1.5公里",价格:"5元"}],events:[{name:"市中心广场",position:"导航数据",description:"市中心广场是个好地方",images:["图片111 base64","图片112 base64"]},{name:"历史博物馆",position:"导航数据",description:"描述烫烫烫烫烫烫烫烫烫锟斤拷fcdafeasfqasaqfasfafasfqfqwfqwfwqqwqwaszxcs",images:["图片121 base64","图片122 base64"]},{name:"科技馆",position:"导航数据",description:"科技馆是个好地方",images:["图片111 base64","图片112 base64"]},{name:"购物中心",position:"导航数据",description:"购物中心是个好地方呀是个好地方",images:["图片111 base64","图片112 base64"]},{name:"公园",position:"导航数据",description:"公园也是好地方呀也是好地方",images:["图片111 base64","图片112 base64"]}]},{name:"路线2",navigation:[{起点:{name:"火焰山",address:"灵台方寸山",location:{latitude:11.118,longitude:2.22226}},终点:{name:"渣滓洞",address:"斜月三星洞",location:{latitude:22.899,longitude:33.878}},交通方式:"筋斗云",路程:"十万八千里",价格:"统统不要钱"}],events:[{name:"途径点1",position:"导航数据",description:"描述",images:["图片211 base64","图片212 base64"]},{name:"途径点2",position:"导航数据",description:"描述",images:["图片221 base64","图片222 base64"]}]}]});Z(T,e=>{console.log(`Active Name changed to: ${e}`)});function O(){if(k(),_.value.trim()){b.value=!0,i.value.push({from:"user",content:_.value.trim()});const e=i.value.map(n=>n.content).join(`
`);I(e),_.value="",V()}}const D=e=>{console.log(l.value),ge.confirm("退出后您所做的修改全部消失，是否确认退出？","确认退出").then(()=>{e()}).catch(()=>{})};t(null);async function I(e){console.log("sendPost:",e);const n={message:e,rep:"%n"};console.log("postData:",n),fetch("http://1.94.170.22:6001/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(c=>{if(c.ok)return console.log("Response:",c),c.body;throw new Error("Network response was not ok.")}).then(c=>{z.value=!0;const X=c.getReader(),K=new TextDecoder("utf-8");M.value=i.value.length,v.value=o.value.length;let P=null,S=null;const A=t(!0);async function u(F,U,W,Q){let ee=!1,te="";X.read().then(({done:Je,value:ie})=>{K.decode(ie,{stream:!0}).split(/\n\n/).slice(0,-1).forEach(re=>{const h=re.replace(/%n/g,`
`).trim();if(h.includes("data: [end]")){console.log("Stream complete"),b.value=!1,W.value++,Q.value++,V();return}else if(h.includes("event: add"))te=h.slice(h.indexOf("data:")+5).trim(),S||(S={from:"Agent",content:""}),ee=!0;else if(h.includes("event: event")&&(A&&(o.value="",A.value=!1),h.includes("data: [gen_post]"))){h.includes("data: [gen_post]end")&&(z.value=!1);const j=h.slice(h.indexOf("data: [gen_post]")+16).trim();P+=j,U.value+=P.replace(/^nullstart/,"").replace(/end$/,""),console.log("List 2",U.value)}console.log("Received chunk:",h);function ce(j,ue=20){return new Promise(de=>{let Y=0;const me=setInterval(()=>{Y<j.length?(S.content+=j[Y],w.value++,Y++,k()):(clearInterval(me),de())},ue)})}ee?ce(te).then(()=>{F.value[W.value]=S,u(F,U,W,Q)}):u(F,U,W,Q)})})}u(i,o,M,v)}).catch(c=>{console.error("There was a problem with the fetch operation:",c)})}return(e,n)=>{const c=m("el-button"),X=m("el-dialog"),K=m("el-main"),P=m("el-input"),S=m("el-footer"),A=m("el-container");return f(),q(A,null,{default:r(()=>[d(K,null,{default:r(()=>[d($(_e),{ref_key:"scrollbarRef",ref:C,style:{"max-height":"100%"}},{default:r(()=>[g("div",Se,[(f(!0),E(B,null,H(i.value,(u,F)=>(f(),E("div",{key:w.value,class:"message-container"},[g("div",{class:he(["message-bubble",u.from==="user"?"user-bubble":"other-bubble"])},[g("span",{innerHTML:u.content.replace(/\n/g,"<br>")},null,8,Ee)],2)]))),128))]),d(X,{modelValue:x.value,"onUpdate:modelValue":n[2]||(n[2]=u=>x.value=u),width:l.value,"before-close":D,style:{"max-height":"80%"},"align-center":""},{footer:r(()=>[g("div",Te,[d(c,{onClick:n[0]||(n[0]=u=>x.value=!1)},{default:r(()=>[L("取消")]),_:1}),d(c,{type:"primary",onClick:n[1]||(n[1]=u=>{x.value=!1,N()})},{default:r(()=>[L(" 保存 ")]),_:1})])]),default:r(()=>[g("span",null,[y.value?(f(),q(Ne,{post:y.value,key:y.value.text},null,8,["post"])):ve("",!0)])]),_:1},8,["modelValue","width"])]),_:1},512)]),_:1}),d(S,{style:{"background-color":"transparent"}},{default:r(()=>[g("div",Ve,[d(P,{modelValue:_.value,"onUpdate:modelValue":n[3]||(n[3]=u=>_.value=u),autosize:{minRows:1,maxRows:3},style:{width:"70%"},type:"textarea",placeholder:"请输入问题"},null,8,["modelValue"]),d(c,{disabled:b.value,type:"primary",onClick:O,"on@keydown":O,style:{"margin-top":"60px","margin-left":"1%","background-color":"var(--color-light)",border:"none",width:"10%"}},{default:r(()=>[L("发送")]),_:1},8,["disabled"]),d(c,{disabled:o.value=="{}",onClick:n[4]||(n[4]=u=>{y.value=JSON.parse(o.value),x.value=!0}),style:{"margin-top":"60px",width:"10%","margin-left":"1%"}},{default:r(()=>[L("预览")]),_:1},8,["disabled"])])]),_:1})]),_:1})}}}),qe=le(Oe,[["__scopeId","data-v-9200ceec"]]);export{qe as default};
