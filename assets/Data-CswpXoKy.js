import{h as Z,i as o,u as ee,j as ae,k as z,l as le,r as i,o as h,c as M,a as e,w as a,b as r,s as A,v as N,y as x,z as B,I as T,m as $,E as j,J as te,K as E,p as se,f as oe,_ as ne}from"./index-CklsWiTl.js";const p=w=>(se("data-v-13f25915"),w=w(),oe(),w),ue={class:"common-layout"},re=p(()=>r("span",null,"编辑资料",-1)),ce={class:"avatar",style:{"padding-left":"8.5%","margin-top":"-20px"}},de=["src"],ie=p(()=>r("div",{class:"tag"}," 昵称 ",-1)),pe=p(()=>r("br",null,null,-1)),ve=p(()=>r("div",{class:"tag"}," Email ",-1)),_e=p(()=>r("br",null,null,-1)),fe=p(()=>r("div",{class:"tag"}," 密码 ",-1)),me=p(()=>r("br",null,null,-1)),he=p(()=>r("div",{class:"tag"}," 简介 ",-1)),ge=Z({__name:"Data",setup(w){const f=o(""),g=o(""),V=o(""),m=o(""),c=o(!0),I=o(!0),y=o(!1),n=o(),D=o(),G=o(),C=o(!1),v=o(),u=ee(),J=o(u.state.userId),P=o(""),b=o(u.state.userAvatar);ae(()=>u.state.userId),z(()=>u.state.userId,(l,t)=>{console.log(`User ID changed from ${t} to ${l}`),v.value=u.state.userAvatar,b.value=u.state.userAvatar}),z(()=>v.value,(l,t)=>{R(l)},{immediate:!1});const R=l=>{var t=new Image;t.onload=function(){console.log("Image loaded successfully"),l!==u.state.userAvatar&&O()},t.onerror=function(){console.log("Image failed to load")},t.src=l},K=l=>{const t=new FileReader;t.onload=async s=>{var k;const d=(k=s.target)==null?void 0:k.result;b.value=d,v.value=b.value},t.readAsDataURL(l.raw)},L=l=>l.type!=="image/jpeg"&&l.type!=="image/png"?(T.error("Avatar picture must be JPG or PNG format!"),!1):l.size/1024/1024>2?(T.error("Avatar picture size cannot exceed 2MB!"),!1):!0,S=async()=>{try{const l=await $.get(`http://1.94.170.22:5000/get_user_profile?user_id=${J.value}`);n.value=l.data,g.value=n.value.email,V.value=n.value.password,m.value=JSON.parse(n.value.info).bio,v.value=JSON.parse(n.value.info).cover,f.value=n.value.name,D.value=n.value.tele,G.value=n.value.birth,P.value=v.value}catch(l){console.error("There was an error fetching the data!",l)}};le(()=>{S()});const O=async()=>{try{const l=o(JSON.stringify({bio:m.value,cover:v.value})),t=o({user_id:J.value,email:g.value,name:f.value,tele:D.value,info:l.value});console.log(t.value);const s=await $.post("http://1.94.170.22:5000/update_user_profile",t.value);n.value=s.data,u.commit("setUserAvatar",v.value),u.commit("setUserName",f.value),u.commit("setUserBio",m.value)}catch(l){console.error("There was an error sending the post",l)}n.value.status=="success"?j({title:"Success",type:"success",message:"修改成功",duration:1500,offset:200}):j({title:"Oh No",type:"error",message:"修改失败...Something Wrong",duration:1500,offset:200})},W=async()=>{c.value=!c.value,I.value=!0,y.value=!1,O(),C.value=!1,S()},q=()=>{c.value=!c.value,I.value=!0,y.value=!1,S(),C.value=!1},F=()=>{c.value=!c.value,I.value=!1,y.value=!0,C.value=!0};return(l,t)=>{const s=i("el-col"),d=i("el-row"),k=i("el-header"),H=i("el-icon"),Q=i("el-upload"),U=i("el-input"),X=i("el-main"),Y=i("el-container");return h(),M("div",ue,[e(Y,null,{default:a(()=>[e(k,{class:"header",style:{width:"100%"}},{default:a(()=>[e(d,null,{default:a(()=>[e(s,{span:2}),e(s,{span:21},{default:a(()=>[re]),_:1})]),_:1})]),_:1}),e(X,{class:"main"},{default:a(()=>[r("div",ce,[e(Q,{class:"avatar-uploader","show-file-list":!1,"on-change":K,"before-upload":L},{default:a(()=>[b.value?(h(),M("img",{key:0,src:b.value,class:"avatar"},null,8,de)):(h(),A(H,{key:1,class:"avatar-uploader-icon"},{default:a(()=>[e(N(te))]),_:1}))]),_:1})]),ie,e(d,{class:"input-layout"},{default:a(()=>[e(s,{span:2}),e(s,{span:20},{default:a(()=>[e(U,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=_=>f.value=_),disabled:c.value,placeholder:f.value,class:"input"},null,8,["modelValue","disabled","placeholder"])]),_:1}),e(s,{span:2})]),_:1}),pe,ve,e(d,{class:"input-layout"},{default:a(()=>[e(s,{span:2}),e(s,{span:20},{default:a(()=>[e(U,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=_=>g.value=_),disabled:"",placeholder:g.value,class:"input"},null,8,["modelValue","placeholder"])]),_:1}),e(s,{span:2})]),_:1}),_e,fe,e(d,{class:"input-layout"},{default:a(()=>[e(s,{span:2}),e(s,{span:20},{default:a(()=>[e(U,{modelValue:V.value,"onUpdate:modelValue":t[2]||(t[2]=_=>V.value=_),disabled:"",placeholder:V.value,class:"input"},null,8,["modelValue","placeholder"])]),_:1}),e(s,{span:2})]),_:1}),me,he,e(d,{class:"input-layout"},{default:a(()=>[e(s,{span:2}),e(s,{span:20},{default:a(()=>[e(U,{modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=_=>m.value=_),type:"textarea",rows:"4",disabled:c.value,placeholder:m.value,class:"introduce"},null,8,["modelValue","disabled","placeholder"])]),_:1}),e(s,{span:2})]),_:1}),e(d,{class:"row"},{default:a(()=>[e(s,{span:8},{default:a(()=>[y.value?(h(),A(N(E),{key:0,color:"error",class:"button-cancel",type:"primary",onClick:q},{default:a(()=>[x("取消")]),_:1})):B("",!0)]),_:1}),e(s,{span:8},{default:a(()=>[I.value?(h(),A(N(E),{key:0,color:"var(--color-light-light)",class:"button",type:"primary",onClick:F},{default:a(()=>[x("修改")]),_:1})):B("",!0)]),_:1}),e(s,{span:8},{default:a(()=>[y.value?(h(),A(N(E),{key:0,color:"rgb(0,155,0)",class:"button",type:"primary",onClick:W},{default:a(()=>[x("保存")]),_:1})):B("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])}}}),be=ne(ge,[["__scopeId","data-v-13f25915"]]);export{be as default};
