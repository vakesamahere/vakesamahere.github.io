import{_ as E,D as H,G as T,m as $,r as f,o as h,c as w,b as _,a as m,w as v,F as W,d as z,s as x,y as b,t as D,z as K,h as L,H as R,i as p,u as k,j as B,k as q,l as N,q as U,P as V}from"./index-CklsWiTl.js";import{t as F}from"./test_covers-B8hz7QS7.js";const j={props:{searchKeyword:String},components:{waterfall:H,searchbox:T},data(){return{wfRefresher:0,posts:[],windowWidth:0,windowHeight:0,wfDisplay:!1,searchHistory:[{display:"推荐",content:""}],selectIndex:0,wfTrigger:0}},watch:{searchKeyword:{handler(e,s){}},userId:{handler(e,s){this.handleSearch(this.searchKeyword)}},router:{handler(e,s){console.log(this.$router.currentRoute.value.path),this.$router.currentRoute.value.path==="/square"&&this.handleSearch(this.searchKeyword)},deep:!0,immediate:!0}},computed:{userId(){return this.$store.state.userId},router(){return this.$router}},methods:{ifEmpty(){this.posts.length===0&&(this.wfTrigger+=1)},goToSquare(e,s){this.selectIndex=s,this.$router.push({path:"/square",query:{keyword:e}}),this.handleSearch(e)},async handleSearch(e){if(this.posts=[],this.wfRefresher+=1,this.searchHistory[this.selectIndex].content!==e){const t={content:e,display:e.length>8?e.slice(0,8)+"......":e};e===""&&(t.display="推荐");let r=this.searchHistory.findIndex(n=>n.content===t.content&&n.display===t.display);r!==-1||(this.searchHistory.push(t),r=this.searchHistory.length-1),this.goToSquare(e,r)}if(this.$emit("searchChange",e),e===""){this.loadPosts();return}this.posts=[],console.log(e);let s=`http://1.94.170.22:5000/search_posts?keyword=${e}`;this.$store.state.userId!==void 0&&this.$store.state.userId!==null&&(s+=`&user_id=${this.$store.state.userId}`);const d=await $.get(s);console.log(d),setTimeout(()=>{this.posts=d.data,this.ifEmpty()},700)},async loadPosts(){this.posts=[];let e="http://1.94.170.22:5000/get_recommended_posts";this.$store.state.userId!==void 0&&this.$store.state.userId!==null&&(e+=`?user_id=${this.$store.state.userId}`);const s=await $.get(e);console.log(s.data),setTimeout(()=>{this.posts=s.data,this.posts=this.posts.concat(F),this.ifEmpty()},700)},handleEnterPost(e){this.$emit("enterPost",e.uid)},updateWindowSize(){this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight}},mounted(){this.loadPosts(),this.updateWindowSize(),console.log(window.innerWidth),window.addEventListener("resize",this.updateWindowSize),setTimeout(()=>{this.wfDisplay=!0},100)}},G={class:"container-box"},M={class:"search-container"},O={class:"waterfall-container"};function A(e,s,d,g,t,r){const a=f("el-menu-item"),n=f("el-menu"),u=f("waterfall");return h(),w("div",G,[_("div",M,[m(n,{"default-active":t.selectIndex,mode:"vertical","background-color":"var(--bg-color)","text-color":"var(--display-text-color)","active-text-color":"var(--display-text-color-active)",onSelect:e.handleSelect,class:"search-history"},{default:v(()=>[(h(!0),w(W,null,z(t.searchHistory,(l,i)=>(h(),x(a,{key:i,index:i,onClick:y=>r.goToSquare(l.content,i),class:"search-item"},{default:v(()=>[b(D(l.display),1)]),_:2},1032,["index","onClick"]))),128))]),_:1},8,["default-active","onSelect"])]),_("div",O,[t.wfDisplay?(h(),x(u,{key:0,class:"waterfall",list:t.posts,refresher:t.wfRefresher,trigger:t.wfTrigger,onEnterPost:r.handleEnterPost},null,8,["list","refresher","trigger","onEnterPost"])):K("",!0)])])}const J=E(j,[["render",A],["__scopeId","data-v-e3245245"]]),Q={class:"containerTest"},X={class:"subwin1"},Y=L({__name:"SquareView",emits:["searchChange"],setup(e,{emit:s}){var S;const d=s;function g(o){d("searchChange",o)}const t=R(),r=p(((S=t.query.keyword)==null?void 0:S.toString())||""),a=p(!1),n=k(),u=p(n.state.userId),l=p("60%");let i=null;B(()=>n.state.userId),q(()=>n.getters.getUserId,(o,c)=>{console.log(`User ID changed from ${c} to ${o}`)}),q(()=>t.query.keyword,(o,c)=>{o!==void 0&&(console.log(`keyword changed from ${c} to ${o}`),r.value=(o==null?void 0:o.toString())||"")});function y(){a.value=!0}N(()=>{I(),i=window.addEventListener("resize",I)}),U(()=>{i&&window.removeEventListener("resize",i)});const I=()=>{const o=document.documentElement.clientWidth;l.value=o<=768?"100%":"60%"};return(o,c)=>{const P=f("el-dialog");return h(),w("div",Q,[_("div",X,[m(J,{user_id:u.value,onEnterPost:y,onSearchChange:g,searchKeyword:r.value},null,8,["user_id","searchKeyword"])]),m(P,{modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=C=>a.value=C),width:l.value,"align-center":"",destroyOnClose:"true"},{default:v(()=>[_("span",null,[m(V,{userId:u.value,postId:o.postId},null,8,["userId","postId"])])]),_:1},8,["modelValue","width"])])}}}),te=E(Y,[["__scopeId","data-v-83d27682"]]);export{te as default};
